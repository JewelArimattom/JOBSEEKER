<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Details - JobFinder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-blur {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #e2e8f0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(118, 75, 162, 0.4);
        }
        
        .job-detail-card {
            background-color: white;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px -15px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }

        /* Styles for the job description content */
        .job-description h3 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: #1e293b; /* slate-800 */
        }
        .job-description ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
            color: #475569; /* slate-600 */
        }
        .job-description li {
            margin-bottom: 0.5rem;
        }

    </style>
</head>
<body class="text-slate-800">

    <!-- Navigation -->
    <nav class="sticky top-0 left-0 right-0 z-50 nav-blur">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <a href="/JOBSEEKER/frontend/index.html" class="text-2xl font-black gradient-text">JobFinder</a>
                </div>
                <div class="hidden md:block">
                    <div class="flex items-center space-x-8">
                        <a href="/JOBSEEKER/frontend/jobs.html" class="text-slate-600 hover:text-slate-900 font-medium transition-colors">Jobs</a>
                        <a href="/JOBSEEKER/frontend/components/message.html" class="text-slate-600 hover:text-slate-900 font-medium transition-colors">Messages</a>
                        <a href="/JOBSEEKER/frontend/resources.html" class="text-slate-600 hover:text-slate-900 font-medium transition-colors">Resources</a>
                        <a href="/JOBSEEKER/frontend/about.html" class="text-slate-600 hover:text-slate-900 font-medium transition-colors">About</a>
                        <a href="/JOBSEEKER/frontend/components/post-job.html" class="btn-primary text-white px-6 py-2 rounded-full font-semibold text-sm">
                            Post Job
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="py-12 md:py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid lg:grid-cols-3 gap-8">
                
                <!-- Left Column: Job Description -->
                <div class="lg:col-span-2">
                    <div id="job-detail-content" class="job-detail-card p-8">
                        <!-- Content will be dynamically loaded here -->
                        <div class="text-center py-20">
                            <p>Loading job details...</p>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Summary & Apply -->
                <aside class="lg:col-span-1 h-fit lg:sticky top-24">
                    <div id="job-summary-card" class="job-detail-card p-6">
                         <!-- Summary will be dynamically loaded here -->
                    </div>
                </aside>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <!-- Footer content remains the same -->
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', async () => {
    const jobDetailContainer = document.getElementById('job-detail-content');
    const jobSummaryContainer = document.getElementById('job-summary-card');

    async function fetchAndRenderJobDetails() {
        const urlParams = new URLSearchParams(window.location.search);
        const jobId = parseInt(urlParams.get('id'));

        if (!jobId) {
            jobDetailContainer.innerHTML = `<p class="text-center text-red-500">Job ID not found.</p>`;
            return;
        }

        try {
            const response = await fetch(`/JOBSEEKER/backend/get_job_detail.php?id=${jobId}`);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const job = await response.json();

            if (job.error) {
                throw new Error(job.error);
            }
            
            document.title = `${job.job_title} - JobFinder`;

            const companyInitial = job.company_name ? job.company_name.charAt(0).toUpperCase() : 'J';
            const placeholderColors = ['667eea', '764ba2', '34d399', 'fbbf24', 'f87171', '60a5fa'];
            const randomColor = placeholderColors[job.id % placeholderColors.length];
            const logoSrc = job.company_logo_path && !job.company_logo_path.endsWith('/') ? `/JOBSEEKER/backend/${job.company_logo_path}` : `https://placehold.co/100x100/${randomColor}/ffffff?text=${companyInitial}&font=inter`;

            const detailHtml = `
                <div class="flex items-start mb-6">
                    <img src="${logoSrc}" alt="${job.company_name} Logo" class="w-20 h-20 rounded-2xl mr-6 flex-shrink-0">
                    <div>
                        <h1 class="text-3xl font-black text-slate-900">${job.job_title}</h1>
                        <p class="text-lg text-slate-600 mt-1">
                            at <a href="#" class="font-bold text-indigo-600 hover:underline">${job.company_name}</a>
                        </p>
                        <p class="text-slate-500 text-sm mt-2">Posted ${job.posted}</p>
                    </div>
                </div>
                <div class="flex flex-wrap gap-x-6 gap-y-3 text-sm text-slate-700 border-t border-b border-slate-200 py-4 mb-6">
                    <div class="flex items-center"><i class="fas fa-map-marker-alt w-4 mr-2 text-slate-400"></i> ${job.location}</div>
                    <div class="flex items-center"><i class="fas fa-briefcase w-4 mr-2 text-slate-400"></i> ${job.job_type}</div>
                    <div class="flex items-center"><i class="fas fa-chart-line w-4 mr-2 text-slate-400"></i> ${job.experience_level}</div>
                </div>
                <div class="prose max-w-none text-slate-600 leading-relaxed job-description">
                    ${job.description.replace(/\n/g, '<br>')}
                </div>
            `;
            jobDetailContainer.innerHTML = detailHtml;

            const summaryHtml = `
                <h3 class="text-xl font-bold text-slate-800 mb-4">Job Summary</h3>
                <div class="space-y-3 text-slate-600">
                    <div class="flex justify-between">
                        <span class="font-semibold text-slate-500">Salary:</span>
                        <span class="font-bold text-slate-800">${job.salary}</span>
                    </div>
                     <div class="flex justify-between">
                        <span class="font-semibold text-slate-500">Category:</span>
                        <span class="font-medium">${job.job_category}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-semibold text-slate-500">Openings:</span>
                        <span class="font-medium">${job.openings}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-semibold text-slate-500">Apply Before:</span>
                        <span class="font-medium">${job.application_deadline ? new Date(job.application_deadline).toLocaleDateString('en-IN', { day: 'numeric', month: 'long', year: 'numeric'}) : 'N/A'}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-semibold text-slate-500">Skills:</span>
                        <span class="text-right font-medium">${job.tags.join(', ')}</span>
                    </div>
                </div>
                <div class="mt-6 border-t border-slate-200 pt-6">
                    <a href="/JOBSEEKER/frontend/components/apply.html?id=${job.id}" class="w-full text-center block btn-primary text-white font-bold py-3.5 rounded-xl text-lg">
                        <i class="fas fa-paper-plane mr-2"></i> Apply Now
                    </a>
                    <a href="/JOBSEEKER/frontend/messages.html?contactId=${job.id}&jobTitle=${encodeURIComponent(job.job_title)}" class="mt-3 w-full flex items-center justify-center py-3 border-2 border-slate-300 rounded-xl bg-white hover:bg-slate-50 font-bold text-slate-700 transition-colors">
                        <i class="fas fa-comment-dots mr-2"></i> Message Recruiter
                    </a>
                </div>
            `;
            jobSummaryContainer.innerHTML = summaryHtml;

        } catch (error) {
            console.error("Could not fetch job details:", error);
            jobDetailContainer.innerHTML = `<div class="text-center py-20"><p class="text-red-500 font-semibold">Error: Could not load job details.</p><p class="text-slate-500 mt-2">${error.message}</p></div>`;
            jobSummaryContainer.innerHTML = '';
        }
    }

    fetchAndRenderJobDetails();
});
</script>
</body>
</html>
